# 本日のサマリー
- おのさんのAnsible環境の構築を皆で追いかけ。webappのコードを変更し反映して試すまでが目標。
- 本日はZoomに集まって作業。（作業内容を録画しました。）
- Driverがアワノさん、オペレータがおのさん。

# 手順
- githubで空のリポジトリを作成する。（今回はPublic設定）
- githubでcodespacesを開く。
- codespaces画面からコマンドパレットでubuntuを開いてansibleのdev containerを選んで実行環境を構築する。（dev containerでDockerで作成される。）
- codespaces作業
  - ターミナルが開くので、`$ ansible --version`でansibleの動作を確認。
  - 左の垂直ツールバーからgitのアイコンを選びgithubにstage/commitして環境をリポジトリ登録する。
  - ssh-keygenでKeyPairを作成。（秘密鍵はcodespacesの実行環境内にある。pushしない様に注意。）
- EC2作業：接続試験とソースコードの回収
  - EC2インスタンス(ISUCON13f2)のuser:isuconのauthoryzed_keysにssh公開鍵を登録。
  - EC2インスタンス(ISUCON13f2)にssh接続する。
  - ~/webapp以下をリポジトリに登録する。（今回はtar圧縮で固めてからscpでcodespacesにコピーする。）
    - webappが大きすぎる-->node以下を削除、rustはディレクトリ内でcargo cleanをして不要なtraget削除。
    - tarでwebapp.tgzに固める。
- codespaces作業：ansible環境整備
  - $ mkdir ansible
  - $ cd ansible
  - $ touch inventory.ini
  - [wewbserver]にEC2への接続設定を記載。
  - $ ....?   # ここで接続試験
  - ansibleのplaybookを作成する。今回はリモートのEC2をlsをするplaybook。ls-home.yml
  - playbookを実行すると無事にリモートでコマンド実行。  
- codespaces作業：Go環境整備
  - Goのビルド環境がないのでaptでインストール
  - $ cd ~/webapp/go
  - $ make
  - でisupipeの実行バイナリがビルドされる。
- codespaces作業：playbook整備
  - Goをビルドしてsystemdで再起動させるところまで書く。これでソース改変したら反映可能。

# 参考
コードを作成したChatGPTとの[会話](https://chatgpt.com/share/6720e7dd-53bc-800f-80df-8960a6acbf93)
